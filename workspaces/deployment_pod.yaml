--- 
apiVersion: v1
kind: PersistentVolumeClaim # 영구 스토리지 생성을 요청하는 객체
metadata:
  name: test-pvc # PVC 이름
  namespace: sdlee # 네임 스페이스 명
spec:
  storageClassName: nfs-storageclass
  accessModes:
    - ReadWriteMany # 스토리지 액세스 모드 (ReadWriteMany, ReadWriteOnce, ReadOnlyMany)
  resources:
    requests:
      storage: 10Gi # 용량은 지정되어있지만 실제로 10G 이상 사용 가능

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: test-deploy # 배포 이름
  namespace: sdlee # 네임 스페이스 명
  labels:
    app: test-centos # 배포 이름
spec:
  replicas: 1
  selector:
    matchLabels:
      app: test-centos # 배포 이름
  template:
    metadata:
      labels:
        app: test-centos # 배포 이름
    spec:
      volumes:
        - name: test-volume # 볼륨명
          persistentVolumeClaim:
            claimName: test-pvc
      containers:
        - name: test-centos  # 컨테이너 이름
          image: "centos:7" # 이미지명 
          imagePullPolicy: IfNotPresent
          command: ["sleep", "infinity"]
        #  ports: # 컨테이너 내부에서 사용하는 포트 명시
        #     - name: http  
        #       containerPort: 80
        #       protocol: TCP
        #     - name: https
        #       containerPort: 443
        #       protocol: TCP
          volumeMounts: # 영구 저장할 볼륨 (디렉토리) 설정
            - name: test-volume # 위에서 명시한 볼륨명 지정
              mountPath: /home/data # 컨테이너 내부 폴더위치
      
---
apiVersion: v1
kind: Service
metadata:
  name: test-centos-service # 서비스 이름
  namespace: sdlee
spec:
  selector:
    app: test-centos # 연결할 Deployment의 이름
  type: LoadBalancer # 서비스 유형 LoadBalancer는 172.17.250.100 ~ 172.17.250.150 중에서 자동 할당하도록 설정되어있음
  ports:
  - name: service-port
    port: 80 # Pod 내부에서 사용하는 포트
    protocol: TCP
  # externalIPs: # 필요한 경우 아이피 지정 가능 (단, 로드밸런서의 아이피 설정 범위에 한해서)
  #   - 172.17.250.120